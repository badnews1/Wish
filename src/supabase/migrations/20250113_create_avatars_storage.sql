-- =====================================================
-- Миграция: Создание Storage bucket для аватаров
-- Дата: 2025-01-13
-- Описание: Создаёт публичный bucket для хранения аватаров пользователей
--           RLS политики настраиваются через Dashboard UI
-- =====================================================

-- ============================================
-- 1. Создание bucket для аватаров
-- ============================================

INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
VALUES (
  'avatars',
  'avatars',
  true, -- публичный доступ для чтения
  2097152, -- 2MB в байтах
  ARRAY['image/jpeg', 'image/jpg', 'image/png', 'image/webp']
)
ON CONFLICT (id) DO NOTHING;

-- ============================================
-- 2. RLS политики
-- ============================================
-- ВАЖНО: Политики для storage.objects нужно создавать через Dashboard UI,
-- так как SQL требует прав владельца таблицы.
-- 
-- Инструкция по настройке политик:
-- 1. Откройте Dashboard → Storage → avatars → Policies
-- 2. Создайте политики согласно /supabase/STORAGE_SETUP.md

-- ============================================
-- DOWN MIGRATION (откат)
-- ============================================
-- Раскомментируйте и выполните для отката миграции

/*
-- Удаление bucket
DELETE FROM storage.buckets WHERE id = 'avatars';

-- ВНИМАНИЕ: Это также удалит все загруженные аватары!
-- Используйте с осторожностью.
*/